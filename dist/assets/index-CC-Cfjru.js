(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))o(a);new MutationObserver(a=>{for(const r of a)if(r.type==="childList")for(const s of r.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&o(s)}).observe(document,{childList:!0,subtree:!0});function n(a){const r={};return a.integrity&&(r.integrity=a.integrity),a.referrerPolicy&&(r.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?r.credentials="include":a.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(a){if(a.ep)return;a.ep=!0;const r=n(a);fetch(a.href,r)}})();let c=[{id:1,name:"智慧导师",icon:"🧙",description:"博学多才，善于解答各种问题",personality:"耐心、睿智、温和",createdAt:"2024-01-15",lastActive:"刚刚",conversationCount:45},{id:2,name:"创意助手",icon:"🎨",description:"富有想象力，擅长创意和设计",personality:"活泼、创新、艺术感强",createdAt:"2024-01-10",lastActive:"5分钟前",conversationCount:38},{id:3,name:"商业顾问",icon:"💼",description:"专业商务，擅长策略分析和市场规划",personality:"理性、专业、目标导向",createdAt:"2024-01-05",lastActive:"1小时前",conversationCount:44}],i=c[0],d={},m=null;function E(){c.forEach(t=>{d[t.id]=[{type:"ai",author:t.name,text:`你好！我是${t.name}，很高兴与你交流。`,time:"14:25"}]})}function u(){const t=document.getElementById("characterList");t&&(t.innerHTML="",c.forEach(e=>{const n=document.createElement("div");n.className=`character-item ${e.id===i.id?"active":""}`,n.onclick=()=>I(e.id),n.innerHTML=`
      <div class="character-header">
        <div class="character-avatar">${e.icon}</div>
        <div class="character-name">${e.name}</div>
      </div>
      <div class="character-desc">${e.description}</div>
      <div style="font-size: 10px; color: #8b4513; margin-top: 5px;">
        最后对话：${e.lastActive}
      </div>
    `,t.appendChild(n)}))}function f(){const t=document.getElementById("characterManagement");t&&(t.innerHTML="",c.forEach(e=>{const n=document.createElement("div");n.className="character-card",n.innerHTML=`
      <div class="character-avatar" style="width: 60px; height: 60px; font-size: 30px;">${e.icon}</div>
      <div class="character-card-info">
        <h3>${e.name}</h3>
        <p>描述：${e.description}</p>
        <p>性格：${e.personality}</p>
        <div class="meta">创建时间：${e.createdAt}</div>
      </div>
      <div class="character-actions">
        <button class="btn btn-small btn-edit" onclick="editCharacter(${e.id})">编辑</button>
        <button class="btn btn-small btn-delete" onclick="deleteCharacter(${e.id})">删除</button>
      </div>
    `,t.appendChild(n)}))}function I(t){const e=c.find(a=>a.id===t);if(!e)return;i=e,u(),g(t);const n=document.getElementById("currentCharacterAvatar"),o=document.getElementById("currentCharacterName");n&&(n.textContent=i.icon),o&&(o.textContent=i.name)}function g(t){const e=document.getElementById("chatMessages");if(!e)return;e.innerHTML="",(d[t]||[]).forEach(o=>{v(o)}),e.scrollTop=e.scrollHeight}function v(t){const e=document.getElementById("chatMessages");if(!e)return;const n=document.createElement("div");n.className=`message ${t.type}`;const o=t.type==="ai"?i.icon:"👤";n.innerHTML=`
    <div class="message-avatar">${o}</div>
    <div class="message-content">
      ${t.type==="ai"?`<div class="message-author">${t.author}</div>`:""}
      <div class="message-text">${t.text}</div>
      <div class="message-time">${t.time}</div>
    </div>
  `,e.appendChild(n)}function y(){const t=document.getElementById("messageInput");if(!t)return;const e=t.value.trim();if(!e)return;const n={type:"user",text:e,time:new Date().toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"})};d[i.id].push(n),v(n),t.value="",setTimeout(()=>{const o={type:"ai",author:i.name,text:w(e,i),time:new Date().toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"})};d[i.id].push(o),v(o);const a=document.getElementById("chatMessages");a&&(a.scrollTop=a.scrollHeight),h()},1e3)}function w(t,e){const o={智慧导师:["这是一个很有趣的问题，让我来为你详细解答。","从我的经验来看，这个问题有几个关键点需要考虑。","你提出了一个很好的观点，我建议你可以从以下几个方面深入思考。"],创意助手:["哇！这个想法太有创意了！我有一些更有趣的建议给你。","让我发挥一下想象力，我觉得可以这样设计...","这个概念很棒！我们可以加入更多创新的元素。"],商业顾问:["从商业角度分析，这个方案有几个优势和需要注意的风险。","根据市场调研数据，我建议采用以下策略来优化这个项目。","这个投资机会看起来很有潜力，但我们需要仔细评估ROI。"]}[e.name]||["这是一个很好的问题，让我为你分析一下。"];return o[Math.floor(Math.random()*o.length)]}function B(t){t.key==="Enter"&&(t.preventDefault(),y())}function M(){const t=document.getElementById("chatInterface"),e=document.getElementById("settingsInterface");t==null||t.classList.remove("active"),e==null||e.classList.add("active")}function L(){const t=document.getElementById("chatInterface"),e=document.getElementById("settingsInterface");e==null||e.classList.remove("active"),t==null||t.classList.add("active")}function b(t,e){document.querySelectorAll(".menu-item").forEach(n=>{n.classList.remove("active")}),t.currentTarget.classList.add("active"),console.log("切换到标签页:",e)}function x(){m=null;const t=document.getElementById("modalTitle");t.textContent="添加新人物",document.getElementById("characterForm").reset(),document.getElementById("characterModal").style.display="block"}function A(t){const e=c.find(n=>n.id===t);e&&(m=t,document.getElementById("modalTitle").textContent="编辑人物",document.getElementById("characterName").value=e.name,document.getElementById("characterIcon").value=e.icon,document.getElementById("characterDesc").value=e.description,document.getElementById("characterPersonality").value=e.personality,document.getElementById("characterModal").style.display="block")}function T(t){confirm("确定要删除这个人物吗？")&&(c=c.filter(e=>e.id!==t),delete d[t],i.id===t&&c.length>0&&(i=c[0]),u(),f(),h(),c.length>0&&(g(i.id),document.getElementById("currentCharacterAvatar").textContent=i.icon,document.getElementById("currentCharacterName").textContent=i.name))}function p(){document.getElementById("characterModal").style.display="none"}function h(){const t=c.length,e=Object.values(d).reduce((s,l)=>s+l.filter(C=>C.type==="user").length,0),n=c.reduce((s,l)=>s.conversationCount>l.conversationCount?s:l,c[0]),o=document.getElementById("totalCharacters"),a=document.getElementById("totalConversations"),r=document.getElementById("mostActive");o&&(o.textContent=t),a&&(a.textContent=e),r&&(r.textContent=n?n.name:"无")}function $(){alert("附件功能开发中...")}document.addEventListener("DOMContentLoaded",()=>{E(),u(),f(),g(i.id),h();const t=document.getElementById("characterForm");t==null||t.addEventListener("submit",e=>{e.preventDefault();const n={name:document.getElementById("characterName").value,icon:document.getElementById("characterIcon").value,description:document.getElementById("characterDesc").value,personality:document.getElementById("characterPersonality").value};if(m){const o=c.find(a=>a.id===m);o&&Object.assign(o,n)}else{const o={id:Date.now(),...n,createdAt:new Date().toISOString().split("T")[0],lastActive:"刚刚",conversationCount:0};c.push(o),d[o.id]=[]}u(),f(),h(),p()})});window.showSettings=M;window.showChat=L;window.showSettingsTab=b;window.showAddCharacterModal=x;window.editCharacter=A;window.deleteCharacter=T;window.closeCharacterModal=p;window.sendMessage=y;window.handleKeyPress=B;window.attachFile=$;
