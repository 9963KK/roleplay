<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>角色扮演AI</title>
  </head>
  <body data-theme="light">
    <div class="container">
      <!-- 对话界面 -->
      <div id="chatInterface" class="interface active">
        <div class="header">
          <h1>🍺 角色扮演AI</h1>
          <div class="header-buttons">
            <button class="icon-btn" onclick="showSettings()" aria-label="设置">
              <!-- Custom SVG gear: 8 teeth + inner ring -->
              <svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
                <g transform="translate(12 12)">
                  <!-- inner ring -->
                  <circle r="4.5"></circle>
                  <!-- teeth -->
                  <rect x="-1.2" y="-10" width="2.4" height="4" rx="0.9" ry="0.9"></rect>
                  <rect transform="rotate(45)" x="-1.2" y="-10" width="2.4" height="4" rx="0.9" ry="0.9"></rect>
                  <rect transform="rotate(90)" x="-1.2" y="-10" width="2.4" height="4" rx="0.9" ry="0.9"></rect>
                  <rect transform="rotate(135)" x="-1.2" y="-10" width="2.4" height="4" rx="0.9" ry="0.9"></rect>
                  <rect transform="rotate(180)" x="-1.2" y="-10" width="2.4" height="4" rx="0.9" ry="0.9"></rect>
                  <rect transform="rotate(225)" x="-1.2" y="-10" width="2.4" height="4" rx="0.9" ry="0.9"></rect>
                  <rect transform="rotate(270)" x="-1.2" y="-10" width="2.4" height="4" rx="0.9" ry="0.9"></rect>
                  <rect transform="rotate(315)" x="-1.2" y="-10" width="2.4" height="4" rx="0.9" ry="0.9"></rect>
                </g>
              </svg>
            </button>
          </div>
        </div>

        <div class="chat-container">
          <div class="sidebar">
            <div class="sidebar-search">
              <svg class="search-icon" viewBox="0 0 24 24" width="18" height="18" aria-hidden="true" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="11" cy="11" r="7"></circle>
                <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
              </svg>
              <input type="text" id="historySearch" placeholder="搜索对话..." />
            </div>
            <h3>历史对话</h3>
            <div class="history-list" id="historyList">
              <!-- 历史对话列表将通过JavaScript动态生成 -->
            </div>
            <button class="fab-new-chat" onclick="newConversation()" aria-label="新建对话">＋</button>
          </div>

          <div class="chat-area">
            <div class="chat-header">
              <div class="character-avatar" id="currentCharacterAvatar">🧙</div>
              <div>
                <div class="name-switcher" id="roleNameButton">
                  <div class="character-name" id="currentCharacterName">智慧导师</div>
                  <span class="caret">▾</span>
                </div>
              </div>
              <div id="roleDropdown" class="model-dropdown hidden"></div>
            </div>

            <div class="chat-messages" id="chatMessages">
              <!-- 对话内容将通过JavaScript动态生成 -->
            </div>

            <div class="chat-input">
              <div class="input-container">
                <div class="input-top">
                  <div class="input-left">
                    <input type="text" class="input-field" id="messageInput" placeholder="询问任何问题" onkeypress="handleKeyPress(event)" />
                  </div>
                </div>
                <div class="input-toolbar">
                  <div class="tool-left">
                    <button class="action-btn" title="添加附件" onclick="attachFile()">
                      <svg viewBox="0 0 24 24" aria-hidden="true" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 5v14M5 12h14"/></svg>
                    </button>
                    <button class="action-btn" title="语音通话" onclick="startVoiceCall()">
                      <svg viewBox="0 0 24 24" aria-hidden="true" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.86 19.86 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6A19.86 19.86 0 0 1 2.08 4.18 2 2 0 0 1 4.06 2h3a2 2 0 0 1 2 1.72c.12.9.37 1.77.72 2.58a2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.5-1.2a2 2 0 0 1 2.11-.45c.81.35 1.68.6 2.58.72A2 2 0 0 1 22 16.92z"/></svg>
                    </button>
                    <button class="action-btn" data-action="voice" title="语音输入" onclick="startVoiceInput()" aria-pressed="false">
                      <svg viewBox="0 0 24 24" aria-hidden="true" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M12 19v3" />
                        <path d="M8 7a4 4 0 0 1 8 0v4a4 4 0 0 1-8 0V7z" />
                        <path d="M5 11v1a7 7 0 0 0 14 0v-1" />
                      </svg>
                    </button>
                  </div>
                  <button class="send-btn" onclick="sendMessage()">➤</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- 设置界面 -->
      <div id="settingsInterface" class="interface">
        <div class="header">
          <h1>系统设置</h1>
          <div class="header-buttons">
            <button class="btn-back" onclick="showChat()" aria-label="返回对话">
              <svg class="icon" viewBox="0 0 24 24" width="18" height="18" aria-hidden="true" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="19" y1="12" x2="5" y2="12"></line>
                <polyline points="12 19 5 12 12 5"></polyline>
              </svg>
              <span>返回对话</span>
            </button>
          </div>
        </div>

        <div class="settings-container">
          <div class="settings-sidebar">
            <div class="settings-menu">
              <div class="menu-item active" onclick="showSettingsTab(event, 'characters')">人物设置</div>
              <div class="menu-item" onclick="showSettingsTab(event, 'models')">模型设置</div>
            </div>
          </div>

          <div class="settings-content">
            <!-- 人物设置面板 -->
            <div class="settings-panel" id="panel-characters">
              <div class="settings-header">
                <h2>自定义人物管理</h2>
                <button class="btn" onclick="showAddCharacterModal()">+ 添加人物</button>
              </div>

              

              <div class="character-management" id="characterManagement">
                <!-- 人物管理卡片将通过JavaScript动态生成 -->
              </div>

              <div class="stats-panel">
                <h3>统计信息</h3>
                <div class="stats-grid">
                  <div class="stat-item">总人物数量：<span id="totalCharacters">3</span></div>
                  <div class="stat-item">总对话次数：<span id="totalConversations">127</span></div>
                  <div class="stat-item">平均对话时长：<span id="avgDuration">8.5分钟</span></div>
                  <div class="stat-item">今日对话次数：<span id="todayConversations">12</span></div>
                  <div class="stat-item">最活跃人物：<span id="mostActive">智慧导师</span></div>
                  <div class="stat-item">系统运行时间：<span id="uptime">30天</span></div>
                </div>
              </div>
            </div>

            <!-- 模型设置面板 -->
            <div class="settings-panel hidden" id="panel-models">
              <div class="settings-header">
                <h2>模型设置</h2>
              </div>
              <div id="modelList" class="model-list">
                <!-- 模型列表由JS渲染 -->
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- 添加/编辑人物模态框 -->
    <div id="characterModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 id="modalTitle">添加新人物</h3>
          <button class="close-btn" onclick="closeCharacterModal()">&times;</button>
        </div>

        <form id="characterForm">
          <div class="form-body-scroll">
            <div class="form-group">
              <label for="characterName">人物名称</label>
              <input type="text" id="characterName" required />
            </div>

            <div class="form-group">
              <label for="characterEmoji">人物头像</label>
              <div class="avatar-input-panel" id="avatarInputPanel">
                <div class="avatar-preview" id="avatarPreview" aria-label="头像预览"></div>
                <div class="avatar-mode-switch" role="tablist">
                  <button type="button" class="avatar-mode-btn active" data-avatar-mode="emoji">Emoji</button>
                  <button type="button" class="avatar-mode-btn" data-avatar-mode="url">图片链接</button>
                  <button type="button" class="avatar-mode-btn" data-avatar-mode="upload">上传图片</button>
                </div>
                <div class="avatar-input-field" data-avatar-field="emoji">
                  <input type="text" id="characterEmoji" placeholder="例如：🧙" maxlength="4" />
                </div>
                <div class="avatar-input-field hidden" data-avatar-field="url">
                  <input type="url" id="characterAvatarUrl" placeholder="https://example.com/avatar.png" />
                </div>
                <div class="avatar-input-field hidden" data-avatar-field="upload">
                  <label class="avatar-upload-btn">
                    <input type="file" id="characterAvatarFile" accept="image/*" hidden />
                    <span>选择图片</span>
                  </label>
                  <div class="avatar-upload-hint">支持 PNG/JPG/GIF，建议大小不超过 1MB。</div>
                </div>
              </div>
            </div>

            <div class="form-group">
              <label for="characterDesc">人物描述</label>
              <textarea id="characterDesc" placeholder="描述这个人物的特点和功能" required></textarea>
            </div>

            <div class="form-group">
              <label for="characterPersonality">性格特点</label>
              <textarea id="characterPersonality" placeholder="描述这个人物的性格特征" required></textarea>
            </div>

            <div class="form-group">
              <label for="characterBackground">背景信息</label>
              <textarea id="characterBackground" placeholder="补充角色的世界观、职责或限制"></textarea>
            </div>

            <div class="form-group">
              <label for="characterFormat">回答格式</label>
              <textarea id="characterFormat" placeholder="指定输出结构，例如：列表、Markdown 模板、JSON"></textarea>
            </div>

            <div class="form-group">
              <label for="characterOpening">开场发言</label>
              <textarea id="characterOpening" placeholder="用户开始对话时人物的问候语"></textarea>
            </div>
          </div>

          <div class="form-actions">
            <button type="button" class="btn btn-secondary" onclick="closeCharacterModal()">取消</button>
            <button type="submit" class="btn">保存</button>
          </div>
        </form>
      </div>
    </div>

    <script type="module" src="/src/main.js"></script>
  </body>
</html>
